<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <form enctype="multipart/form-data" method="post" action="/api/file/upload">
        <fieldset>
            <legend style="padding-top: 10px; padding-bottom: 10px;">Upload Images</legend>

            <div class="col-xs-12" style="padding: 10px;">
                <div class="col-xs-4">
                    <label>Upload</label>
                </div>
                <div class="col-xs-7">
                    <input type="file" id="fileInput" name="files" onchange="fileChange(this.files)" multiple>
                </div>
            </div>

            <div class="col-xs-12" style="padding: 10px;">
                <div class="col-xs-4">
                    <!--<input type="submit" value="Upload" id="ajaxUploadButton" class="btn">-->
                </div>
            </div>
        </fieldset>
    </form>

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.min.js" integrity="sha512-J67nm7fNdd/paUQlLxKoReUffdsPRGHCOYkVwRGUSDv/NE5DJtL6Siinn+s8rZMYJDQJRiPdWjs/PHvjMLnKiw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="/lib/signalr.min.js"></script>
    <script src="/lib/msgpack5.min.js"></script>
    <script src="/lib/signalr-protocol-msgpack.min.js"></script>


    <script type="text/javascript">

        function fileChange(files) {
            var url = '/api/file/upload';
            console.log(files);

            var formData = new FormData();
            for (var i = 0; i < files.length; i++) {
                formData.append(files[i].name, files[i]);
            }

            $.ajax({
                url: url,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (message) {
                    console.log(message);
                },
                error: function () {
                    alert("there was error uploading files!");
                }
            });

        }

        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/hubs/image")
            .withHubProtocol(new signalR.protocols.msgpack.MessagePackHubProtocol())
            .build();

        connection.on("ImageMessage", function (message) {
            console.log(message);
        });

        connection.start()
            .then(function () { console.log('SignalR Started...'); })
            .catch(function (err) { return console.error(err); });</script>
</body>
</html>